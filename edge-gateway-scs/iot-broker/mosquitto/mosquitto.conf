# BEACON IoT Broker - Mosquitto Configuration
# ==========================================

# General settings
pid_file /var/run/mosquitto.pid
user mosquitto
max_queued_messages 1000
message_size_limit 268435456
allow_zero_length_clientid true
allow_duplicate_messages false

# Network listeners
# Plain MQTT
listener 1883 0.0.0.0
protocol mqtt
socket_domain ipv4

# MQTT over TLS
listener 8883 0.0.0.0
protocol mqtt
socket_domain ipv4
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key
tls_version tlsv1.2
require_certificate false

# WebSocket support
listener 9001 0.0.0.0
protocol websockets
socket_domain ipv4

# WebSocket over TLS
listener 9002 0.0.0.0
protocol websockets
socket_domain ipv4
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key

# Persistence
persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db
autosave_interval 1800
autosave_on_changes false

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest console
log_type error
log_type warning
log_type notice
log_type information
log_type debug
connection_messages true
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Security
allow_anonymous false
password_file /mosquitto/config/passwd
acl_file /mosquitto/config/acl

# Connection limits
max_connections 1000
max_inflight_messages 50
max_queued_bytes 0

# Keep alive settings
keepalive_interval 60
retry_interval 20
store_clean_interval 10

# Bridge configuration (for multi-gateway communication)
# connection bridge-beacon
# address beacon-central:1883
# topic beacon/# both 0
# bridge_protocol_version mqttv311
# bridge_insecure false

# Websocket settings
websockets_log_level 0
websockets_headers_size 1024

# Additional security
set_tcp_nodelay true
